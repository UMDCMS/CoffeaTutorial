<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Navigating jupyter notebooks &#8212; Unofficial Coffea Tutorial  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css?v=0f882399" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Learning the awkward arrays syntax" href="awkwardbasic.html" />
    <link rel="prev" title="Installing a coffea environment" href="../installation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="awkwardbasic.html" title="Learning the awkward arrays syntax"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../installation.html" title="Installing a coffea environment"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Unofficial Coffea Tutorial  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Navigating jupyter notebooks</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="Navigating-jupyter-notebooks">
<h1>Navigating jupyter notebooks<a class="headerlink" href="#Navigating-jupyter-notebooks" title="Link to this heading">¶</a></h1>
<p>The typical workflow for of coffea uses <a class="reference external" href="https://jupyter.org/">notebooks</a>, which allows for rapid testing of code in development, as well as having a window that is can display analysis results without needing to switch a new window. The <a class="reference external" href="../installation.html">installation and setup commands</a> already includes the command to initialize a server for notebooks. Here is mainly to help people who are unfamiliar with notebook to get started.</p>
<section id="More-information-regarding-starting-a-notebook-server">
<h2>More information regarding starting a notebook server<a class="headerlink" href="#More-information-regarding-starting-a-notebook-server" title="Link to this heading">¶</a></h2>
<p>Notebooks servers generate the interface through network protocols, which can be access via your favorite browser. If you are running the commands one your personal machine, once you run the <code class="docutils literal notranslate"><span class="pre">jupy.sh</span></code> script, the command line should output something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http://127.0.0.1:8888/?token=62bfe8d8e84fe97f8da20
</pre></div>
</div>
<p>This line can be placed in your browsers URL bar to access the default jupyter interface. For security reasons, jupyter servers only allows network access from local connections. If you are using an LPC machine, you will need to setup ssh tunneling to pass traffic from the network port of your local machine to the LPC machine.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ssh -L localhost:8XXX:localhost:8XXX &lt;user&gt;@&lt;machine&gt;
</pre></div>
</div>
<p>Or if you are using <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> to make connection settings persistent:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Host &lt;machine&gt;
  user &lt;user&gt;
  hostname &lt;machine address&gt;
  LocalForward 8XXX &lt;machine address&gt;:&lt;8XXX&gt;
</pre></div>
</div>
<p>Or if you are using the GUI based ssh connector, find the setting under the name of Connection/Tunneling or similar and set</p>
<ul class="simple">
<li><p>source port: 8XXX</p></li>
<li><p>Destination: 127.0.0.1:8XXX</p></li>
</ul>
<p>Be sure to use these connections <strong>before</strong> starting the jupyter script! If not, stop the server session with <code class="docutils literal notranslate"><span class="pre">Ctl+C</span></code>, disconnect out of the ssh session and start again.</p>
</section>
<section id="Navigating-a-server-and-notebook-session">
<h2>Navigating a server and notebook session<a class="headerlink" href="#Navigating-a-server-and-notebook-session" title="Link to this heading">¶</a></h2>
<p>After that you should be greeted with the Jupyter Notebook interface in your browser!</p>
<p><img alt="main browser page" src="../_images/notebook_mainpage.png" /></p>
<p>This is your typical directory tree explorer with the root directory set at where you initiated the jupyter server session. You can either click on a notebook file (extensions are typically <code class="docutils literal notranslate"><span class="pre">ipynb</span></code>) to open and edit an existing notebook, or click on the <strong>New</strong> button in the top right to create a new notebook.</p>
<p><img alt="kernel choice" src="../_images/kernel.png" /></p>
<p>One clicking the button, we will be greeted with the choice of <a class="reference external" href="https://jupyter-notebook-beginner-guide.readthedocs.io/en/latest/what_is_jupyter.html#kernel">kernels</a>. Loosely speaking kernels referes to how the code in the notebook will be interpreted.</p>
<p>In our case we will be choosing the Python 3 kernel. By doing so we should be greeted with a notebook.</p>
<p><img alt="notebook page" src="../_images/notebook.png" /></p>
<p>You can change the name of the notebook file on the top title bar. Now lets look at the main structure of notebooks: <strong>cells</strong>, highlighted with the wide red box in the image above. Cells are chunks of (python) code to be executed by the server. After completed editing a cell, run the piece of code either by hitting the <strong>Run</strong> button, or hitting <code class="docutils literal notranslate"><span class="pre">Shift+Enter</span></code> with our cursor in the desired code. Any output of the code should also appear below the cell block by default. A new cell will always
appear at the end of the notebook after executing the last cell in the notebook. Or you can use the <strong>insert</strong> button to create new cell anywhere within the notebook.</p>
<p>Cells can also be set to be a markdown cell using the drop-down menu highlighed in green, in which case the output of the cell is a HTML render of the markdown text placed in the cell. This is extremely useful for alternative between documentation and code developments. Most of the pages in this tutorial will also follow a notebook style documentation: such as below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a demonstration code cell in the tutorial&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
This is a demonstration code cell in the tutorial
Hello world
</pre></div></div>
</div>
</section>
<section id="Understanding-cells">
<h2>Understanding cells<a class="headerlink" href="#Understanding-cells" title="Link to this heading">¶</a></h2>
<p>A notebooks can be thought of a cells seperating various code statements that share a common memory pool. This means that variables can be defined in one cells:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myvar</span> <span class="o">=</span> <span class="s1">&#39;This is a test&#39;</span>
</pre></div>
</div>
</div>
<p>And be called and maipuated being sepeared by documentation or file cells</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;myvar is:&#39;</span><span class="p">,</span> <span class="n">myvar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
myvar is: This is a test
</pre></div></div>
</div>
<p>Cells can also be exceuted out of order. We can define the statement in the following cell:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myvar</span> <span class="o">=</span> <span class="n">myvar</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
</pre></div>
</div>
</div>
<p>if reexecuted the cell containing the <code class="docutils literal notranslate"><span class="pre">print('myvar</span> <span class="pre">is:',</span> <span class="pre">myvar)</span></code> statement, it should now show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>myvar is: This is a test
</pre></div>
</div>
<p>The small number to the left of the cell indicates the execution order, for the sake of reading clartiy it is usual practice to not abuse this function, but rather reserve it for code testing:</p>
<p>Supposing we are currently developing a complicated function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_difficult_calculation</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">10</span>
</pre></div>
</div>
</div>
<p>We can isolate this complicated function in a cell and use a new cell to check the results of a function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">my_difficult_calculation</span><span class="p">(</span><span class="n">myvar</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
This is a test.This is a test.This is a test.This is a test.This is a test.This is a test.This is a test.This is a test.This is a test.This is a test.
</pre></div></div>
</div>
<p>Now if we found a some alterations to the <code class="docutils literal notranslate"><span class="pre">my_difficult_calculation</span></code> function, we can simply rerun the cell containing the definition of the function, forcing the kernel to update what <code class="docutils literal notranslate"><span class="pre">my_difficult_calculation</span></code> means for python cells, and rerun all cells containing <code class="docutils literal notranslate"><span class="pre">my_difficult_calculation</span></code></p>
</section>
<section id="Library-and-imports">
<h2>Library and imports<a class="headerlink" href="#Library-and-imports" title="Link to this heading">¶</a></h2>
<p>All notebook cells should have the same access to any python libraries as typical python session running in the same (virtual) environment. Any import command that would work in python should work here:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">coffea</span>
<span class="n">help</span><span class="p">(</span><span class="n">coffea</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">ProcessorABC</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function process in module coffea.processor.processor:

process(self, df)
    Processes a single DataFrame

    Returns a filled accumulator object which can be initialized via self.accumulator.identity()

</pre></div></div>
</div>
<p>Again, because memory is shared across all cells, import statements can be added to the first executed cell in the notebook, and all cell will have access to said package.</p>
<p>A small issue comes when using custom python packages developed specifically for some set of notebooks. If you have the directory structure like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;WORKINGDIR&gt;
├──<span class="w"> </span>coffeaenv
├──<span class="w"> </span>notebooks
│<span class="w">   </span>├──<span class="w"> </span>mynotebook1.ipynb
│<span class="w">   </span>└──<span class="w"> </span>mynotebook2.ipynb
├──<span class="w"> </span>utils
│<span class="w">   </span>├──<span class="w"> </span>utils1.py
│<span class="w">   </span>├──<span class="w"> </span>utils2.py
│<span class="w">   </span>└──<span class="w"> </span>utils3.py
└──<span class="w"> </span>...
</pre></div>
</div>
<p>You may find that the usual import statement in mynotebook1.ipynb such as below</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">utils.utils1</span>
</pre></div>
</div>
<p><strong>might fail</strong>, with the system complaining that utils is not found. This is an issue for what the “current working directory” (<code class="docutils literal notranslate"><span class="pre">cwd</span></code>) is for a specific notebook as straighforwards as executing a python script in a command line. Depending on how the notebook is initialized, the <code class="docutils literal notranslate"><span class="pre">cwd</span></code> can be <code class="docutils literal notranslate"><span class="pre">&lt;WORKINGDIR&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;WORKINGDIR&gt;/notebooks</span></code> or neither of the above.</p>
<p>The what to compensate for this is specific to how your intend to setup your environment, so there is so <code class="docutils literal notranslate"><span class="pre">global</span> <span class="pre">solution</span></code>. The typical solution is <strong>before</strong> starting the jupyter session, setup the environment variable <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> to ensure the package path is included. In the case above, we can run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span>:&lt;full/path/of/WORKINGDIR&gt;
</pre></div>
</div>
<p>If you have been using the <code class="docutils literal notranslate"><span class="pre">./init.sh</span></code> script included in the default setup commands, this variable should already be setup as such, so you can place python packages directly within your working directory, and the typical import commands should work as expected.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Navigating jupyter notebooks</a><ul>
<li><a class="reference internal" href="#More-information-regarding-starting-a-notebook-server">More information regarding starting a notebook server</a></li>
<li><a class="reference internal" href="#Navigating-a-server-and-notebook-session">Navigating a server and notebook session</a></li>
<li><a class="reference internal" href="#Understanding-cells">Understanding cells</a></li>
<li><a class="reference internal" href="#Library-and-imports">Library and imports</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../installation.html"
                          title="previous chapter">Installing a coffea environment</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="awkwardbasic.html"
                          title="next chapter">Learning the awkward arrays syntax</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/notebooks/intronotebook.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="awkwardbasic.html" title="Learning the awkward arrays syntax"
             >next</a> |</li>
        <li class="right" >
          <a href="../installation.html" title="Installing a coffea environment"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Unofficial Coffea Tutorial  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Navigating jupyter notebooks</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2021, UMDCMS.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>